<template>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <AppHeader />
    
    <main class="container mx-auto px-4 py-8">
      
      <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-[#1B3C53] dark:text-white mb-3">
          Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        </h1>
        <p class="text-lg text-[#456882] dark:text-gray-300">
          Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙØªÙ‡
        </p>
      </div>

      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-blue-400">{{ employeeStats.totalContent }}</p>
            </div>
            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center">
              <span class="material-icons text-blue-600 dark:text-blue-400">library_books</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
              <p class="text-2xl font-bold text-amber-600 dark:text-amber-400">{{ employeeStats.pendingReview }}</p>
            </div>
            <div class="w-12 h-12 bg-amber-100 dark:bg-amber-900 rounded-xl flex items-center justify-center">
              <span class="material-icons text-amber-600 dark:text-amber-400">pending</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400">Ù…Ù‚Ø¨ÙˆÙ„Ø©</p>
              <p class="text-2xl font-bold text-green-600 dark:text-green-400">{{ employeeStats.approved }}</p>
            </div>
            <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-xl flex items-center justify-center">
              <span class="material-icons text-green-600 dark:text-green-400">check_circle</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</p>
              <p class="text-2xl font-bold text-purple-600 dark:text-purple-400">{{ employeeStats.totalViews }}</p>
            </div>
            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-xl flex items-center justify-center">
              <span class="material-icons text-purple-600 dark:text-purple-400">visibility</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¨Ø­Ø« -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <!-- Ø¨Ø­Ø« -->
          <div>
            <label class="block text-sm font-medium text-[#1B3C53] dark:text-gray-300 mb-2">Ø¨Ø­Ø«</label>
            <div class="relative">
              <span class="material-icons absolute right-3 top-1/2 transform -translate-y-1/2 text-[#456882] dark:text-gray-400">search</span>
              <input
                v-model="filters.search"
                type="text"
                placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰..."
                class="w-full px-4 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-[#1B3C53] focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-white"
              >
            </div>
          </div>

          <!-- Ø§Ù„Ù†ÙˆØ¹ -->
          <div>
            <label class="block text-sm font-medium text-[#1B3C53] dark:text-gray-300 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù</label>
            <div class="relative">
              <span class="material-icons absolute right-3 top-1/2 transform -translate-y-1/2 text-[#456882] dark:text-gray-400">category</span>
              <select
                v-model="filters.type"
                class="w-full px-4 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-[#1B3C53] focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-white appearance-none"
              >
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                <option value="image">ØµÙˆØ±Ø©</option>
                <option value="video">ÙÙŠØ¯ÙŠÙˆ</option>
                <option value="audio">ØµÙˆØª</option>
                <option value="pdf">PDF</option>
                <option value="document">Ù…Ø³ØªÙ†Ø¯ Ù†ØµÙŠ</option>
                <option value="interactive">ØªÙØ§Ø¹Ù„ÙŠ</option>
              </select>
            </div>
          </div>

          <!-- Ø§Ù„Ø­Ø§Ù„Ø© -->
          <div>
            <label class="block text-sm font-medium text-[#1B3C53] dark:text-gray-300 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <div class="relative">
              <span class="material-icons absolute right-3 top-1/2 transform -translate-y-1/2 text-[#456882] dark:text-gray-400">flag</span>
              <select
                v-model="filters.status"
                class="w-full px-4 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-[#1B3C53] focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-white appearance-none"
              >
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                <option value="published">Ù…Ù†Ø´ÙˆØ±</option>
                <option value="pending_review">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                <option value="draft">Ù…Ø³ÙˆØ¯Ø©</option>
                <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
                <option value="needs_revision">ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„</option>
              </select>
            </div>
          </div>

          <!-- Ø§Ù„ÙØ¦Ø© -->
          <div>
            <label class="block text-sm font-medium text-[#1B3C53] dark:text-gray-300 mb-2">Ø§Ù„ÙØ¦Ø©</label>
            <div class="relative">
              <span class="material-icons absolute right-3 top-1/2 transform -translate-y-1/2 text-[#456882] dark:text-gray-400">class</span>
              <select
                v-model="filters.category"
                class="w-full px-4 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-[#1B3C53] focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-white appearance-none"
              >
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                <option value="ÙˆØ§Ù‚Ø¹ÙŠØ©">ÙˆØ§Ù‚Ø¹ÙŠØ©</option>
                <option value="Ø®ÙŠØ§Ù„">Ø®ÙŠØ§Ù„</option>
                <option value="Ø¯ÙŠÙ†ÙŠ">Ø¯ÙŠÙ†ÙŠ</option>
                <option value="ØªØ¹Ù„ÙŠÙ…ÙŠ">ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
                <option value="ØªØ±ÙÙŠÙ‡ÙŠ">ØªØ±ÙÙŠÙ‡ÙŠ</option>
                <option value="ØªØ§Ø±ÙŠØ®ÙŠ">ØªØ§Ø±ÙŠØ®ÙŠ</option>
                <option value="Ø¹Ù„Ù…ÙŠ">Ø¹Ù„Ù…ÙŠ</option>
                <option value="Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ">Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</option>
              </select>
            </div>
          </div>
        </div>

        <!-- ÙÙ„ØªØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ -->
        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
          <div class="flex items-center justify-between">
            <label class="flex items-center gap-2 text-sm text-[#1B3C53] dark:text-gray-300 cursor-pointer">
              <input
                type="checkbox"
                v-model="filters.myContentOnly"
                class="rounded border-gray-300 focus:ring-[#1B3C53]"
              >
              <span class="material-icons text-base">person</span>
              Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙØªÙ‡ ÙÙ‚Ø·
            </label>
            
            <div class="flex items-center gap-4">
              <span class="text-sm text-[#456882] dark:text-gray-400">
                Ø¹Ø±Ø¶ {{ filteredStories.length }} Ù…Ù† {{ employeeStories.length }}
              </span>
              <button
                @click="resetFilters"
                class="flex items-center gap-2 text-sm text-[#1B3C53] dark:text-blue-400 hover:underline transition-colors duration-200"
              >
                <span class="material-icons text-base">refresh</span>
                Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="p-6 border-b border-gray-200 dark:border-gray-600">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¶Ø§Ù</h3>
            <button
              @click="navigateToAddStory"
              class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#1B3C53] to-[#234C6A] text-white rounded-xl hover:from-[#234C6A] hover:to-[#1B3C53] transition-all duration-200 text-sm font-medium shadow-lg"
            >
              <span class="material-icons text-sm">add</span>
              Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯
            </button>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700">
                <th class="text-right py-4 px-6 text-sm font-medium text-[#1B3C53] dark:text-gray-300">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</th>
                <th class="text-right py-4 px-6 text-sm font-medium text-[#1B3C53] dark:text-gray-300">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</th>
                <th class="text-right py-4 px-6 text-sm font-medium text-[#1B3C53] dark:text-gray-300">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th class="text-right py-4 px-6 text-sm font-medium text-[#1B3C53] dark:text-gray-300">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</th>
                <th class="text-right py-4 px-6 text-sm font-medium text-[#1B3C53] dark:text-gray-300">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th class="text-right py-4 px-6 text-sm font-medium text-[#1B3C53] dark:text-gray-300">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
              <tr 
                v-for="story in filteredStories" 
                :key="story.id"
                class="border-b border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200"
              >
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
                <td class="py-4 px-6">
                  <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-[#1B3C53] to-[#234C6A] rounded-xl flex items-center justify-center text-white text-lg">
                      <span class="material-icons">{{ getTypeIcon(story.story_type) }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h4 class="font-medium text-[#1B3C53] dark:text-white mb-1 truncate">{{ story.title }}</h4>
                      <p class="text-sm text-[#456882] dark:text-gray-400 line-clamp-2 mb-2">{{ story.summary }}</p>
                      <div class="flex items-center gap-2">
                        <span class="text-xs bg-gray-100 dark:bg-gray-600 text-[#456882] dark:text-gray-300 px-2 py-1 rounded">
                          {{ story.vessel_number }}
                        </span>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 px-2 py-1 rounded">
                          {{ getTypeText(story.story_type) }}
                        </span>
                      </div>
                    </div>
                  </div>
                </td>

                <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
                <td class="py-4 px-6">
                  <div class="space-y-2 text-sm">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-[#456882] dark:text-gray-400 text-base">person</span>
                      <span class="text-[#456882] dark:text-gray-400">{{ story.author }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-[#456882] dark:text-gray-400 text-base">category</span>
                      <span class="text-[#456882] dark:text-gray-400">{{ story.category }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-[#456882] dark:text-gray-400 text-base">child_care</span>
                      <span class="text-[#456882] dark:text-gray-400">{{ story.age_group }}</span>
                    </div>
                  </div>
                </td>

                <!-- Ø§Ù„Ø­Ø§Ù„Ø© -->
                <td class="py-4 px-6">
                  <div class="space-y-2">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium" :class="getStatusClass(story.status)">
                      <span class="material-icons text-xs mr-1">{{ getStatusIcon(story.status) }}</span>
                      {{ getStatusText(story.status) }}
                    </span>
                    <div v-if="story.review_notes" class="text-xs text-[#456882] dark:text-gray-400 bg-gray-50 dark:bg-gray-600 p-2 rounded-lg">
                      {{ story.review_notes }}
                    </div>
                    <div v-if="story.reviewed_by" class="text-xs text-[#456882] dark:text-gray-400">
                      ØªÙ…Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø©: {{ story.reviewed_by }}
                    </div>
                  </div>
                </td>

                <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                <td class="py-4 px-6">
                  <div class="space-y-2 text-sm">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-[#456882] dark:text-gray-400 text-base">visibility</span>
                      <span class="text-[#456882] dark:text-gray-400">{{ story.stats?.views || 0 }} Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-[#456882] dark:text-gray-400 text-base">thumb_up</span>
                      <span class="text-[#456882] dark:text-gray-400">{{ story.stats?.likes || 0 }} Ø¥Ø¹Ø¬Ø§Ø¨</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-[#456882] dark:text-gray-400 text-base">download</span>
                      <span class="text-[#456882] dark:text-gray-400">{{ story.stats?.downloads || 0 }} ØªØ­Ù…ÙŠÙ„</span>
                    </div>
                  </div>
                </td>

                <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
                <td class="py-4 px-6">
                  <div class="space-y-1 text-sm">
                    <div class="text-[#456882] dark:text-gray-400">{{ formatDate(story.created_at) }}</div>
                    <div v-if="story.submitted_at" class="text-[#456882] dark:text-gray-400 text-xs">
                      Ø£Ø±Ø³Ù„Øª: {{ formatDate(story.submitted_at) }}
                    </div>
                  </div>
                </td>

                <!-- Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <td class="py-4 px-6">
                  <div class="flex items-center gap-1 justify-end">
                    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© -->
                    <button
                      @click="previewStory(story)"
                      class="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors duration-200"
                      title="Ù…Ø¹Ø§ÙŠÙ†Ø©"
                    >
                      <span class="material-icons text-sm">visibility</span>
                    </button>

                    <!-- ØªØ¹Ø¯ÙŠÙ„ -->
                    <router-link
                      :to="`/employee/stories/edit/${story.id}`"
                      class="p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors duration-200"
                      title="ØªØ¹Ø¯ÙŠÙ„"
                    >
                      <span class="material-icons text-sm">edit</span>
                    </router-link>

                    <!-- Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
                    <button
                      v-if="story.status === 'draft' || story.status === 'needs_revision'"
                      @click="submitForReview(story)"
                      class="p-2 text-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/20 rounded-lg transition-colors duration-200"
                      title="Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"
                    >
                      <span class="material-icons text-sm">send</span>
                    </button>

                    <!-- Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· -->
                    <button
                      v-if="story.status === 'published'"
                      @click="copyStoryLink(story)"
                      class="p-2 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors duration-200"
                      title="Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·"
                    >
                      <span class="material-icons text-sm">link</span>
                    </button>

                    <!-- Ø­Ø°Ù -->
                    <button
                      v-if="story.status === 'draft' || story.status === 'rejected'"
                      @click="deleteStory(story)"
                      class="p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200"
                      title="Ø­Ø°Ù"
                    >
                      <span class="material-icons text-sm">delete</span>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø­ØªÙˆÙ‰ -->
          <div v-if="filteredStories.length === 0" class="text-center py-12">
            <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="material-icons text-gray-400 text-2xl">collections_bookmark</span>
            </div>
            <h3 class="text-lg font-medium text-[#1B3C53] dark:text-white mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙŠØ§Øª</h3>
            <p class="text-[#456882] dark:text-gray-400 mb-6">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ ÙŠØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
            <button
              @click="navigateToAddStory"
              class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-[#1B3C53] to-[#234C6A] text-white rounded-xl hover:from-[#234C6A] hover:to-[#1B3C53] transition-all duration-200 font-medium shadow-lg"
            >
              <span class="material-icons">add</span>
              Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ø­ØªÙˆÙ‰
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>
</template>

<script>
import { ref, onMounted, onUnmounted, computed } from 'vue'
import { useRouter } from 'vue-router'
import StatisticsManager from '@/utils/statisticsManager'

export default {
  name: 'EmployeeStoriesManagement',
  setup() {
    const router = useRouter()
    const stories = ref([])
    const user = ref(null)
    const filters = ref({
      search: '',
      type: '',
      status: '',
      category: '',
      myContentOnly: true
    })

    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø­Ø¸ÙŠ
    const setupRealTimeUpdates = () => {
      window.addEventListener('storiesUpdated', loadData)
      window.addEventListener('interactionsUpdated', loadData)
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯
    const navigateToAddStory = () => {
      console.log('ğŸ”„ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯...')
      router.push('/employee/stories/new')
        .then(() => {
          console.log('âœ… [Ø§Ù„Ù…ÙˆØ¸Ù] ØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯')
        })
        .catch(error => {
          console.error('âŒ [Ø§Ù„Ù…ÙˆØ¸Ù] ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯:', error)
          window.location.href = '/employee/stories/new'
        })
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const loadData = () => {
      try {
        console.log('ğŸ”„ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...')
        
        const userData = localStorage.getItem('userData')
        if (userData) {
          user.value = JSON.parse(userData)
          console.log('ğŸ‘¤ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', user.value)
        } else {
          console.warn('âš ï¸ [Ø§Ù„Ù…ÙˆØ¸Ù] Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…')
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØµ Ù…Ù† localStorage
        const savedStories = localStorage.getItem('libraryStories')
        console.log('ğŸ“ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ù…Ù† localStorage:', savedStories)
        
        if (savedStories) {
          const parsedStories = JSON.parse(savedStories)
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ÙƒÙ„ Ù‚ØµØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… StatisticsManager
          stories.value = parsedStories.map(story => ({
            ...story,
            stats: StatisticsManager.getStoryStatistics(story.id)
          }))
          console.log('âœ… [Ø§Ù„Ù…ÙˆØ¸Ù] Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…Ø­Ù…Ù„Ø©:', stories.value.length)
        } else {
          stories.value = []
          console.log('âš ï¸ [Ø§Ù„Ù…ÙˆØ¸Ù] Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ØµØµ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ')
        }
      } catch (error) {
        console.error('âŒ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error)
        stories.value = []
      }
    }

    // Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…ÙˆØ¸Ù
    const employeeStories = computed(() => {
      if (!user.value) {
        console.log('ğŸ‘¤ [Ø§Ù„Ù…ÙˆØ¸Ù] Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„')
        return []
      }
      
      const employeeContent = stories.value.filter(story => {
        const isAddedByUser = story.added_by === user.value.name || 
                             story.added_by_id === user.value.id ||
                             (story.added_by && user.value.name && story.added_by.includes(user.value.name))
        
        console.log(`ğŸ” [Ø§Ù„Ù…ÙˆØ¸Ù] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ØµØ© "${story.title}":`, {
          added_by: story.added_by,
          added_by_id: story.added_by_id,
          user_name: user.value.name,
          user_id: user.value.id,
          matches: isAddedByUser
        })
        
        return isAddedByUser
      })
      
      console.log('ğŸ‘¤ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø§Ù„Ù‚ØµØµ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…ÙˆØ¸Ù:', employeeContent)
      return employeeContent
    })

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
    const employeeStats = computed(() => {
      const employeeContent = employeeStories.value
      
      // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      const totalViews = employeeContent.reduce((total, story) => {
        return total + (story.stats?.views || 0)
      }, 0)
      
      console.log('ğŸ“ˆ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸Ù:', {
        total: employeeContent.length,
        pending: employeeContent.filter(s => s.status === 'pending_review').length,
        approved: employeeContent.filter(s => s.status === 'published').length,
        rejected: employeeContent.filter(s => s.status === 'rejected').length,
        totalViews: totalViews
      })
      
      return {
        totalContent: employeeContent.length,
        pendingReview: employeeContent.filter(s => s.status === 'pending_review').length,
        approved: employeeContent.filter(s => s.status === 'published').length,
        rejected: employeeContent.filter(s => s.status === 'rejected').length,
        totalViews: totalViews
      }
    })

    // Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ØµÙÙ‰
    const filteredStories = computed(() => {
      let filtered = employeeStories.value

      if (filters.value.myContentOnly) {
        filtered = filtered.filter(story => 
          story.added_by === user.value?.name || 
          story.added_by_id === user.value?.id
        )
      }

      if (filters.value.search) {
        const search = filters.value.search.toLowerCase()
        filtered = filtered.filter(story => 
          (story.title && story.title.toLowerCase().includes(search)) ||
          (story.summary && story.summary.toLowerCase().includes(search)) ||
          (story.author && story.author.toLowerCase().includes(search)) ||
          (story.vessel_number && story.vessel_number.toLowerCase().includes(search))
        )
      }

      if (filters.value.type) {
        filtered = filtered.filter(story => story.story_type === filters.value.type)
      }

      if (filters.value.status) {
        filtered = filtered.filter(story => story.status === filters.value.status)
      }

      if (filters.value.category) {
        filtered = filtered.filter(story => story.category === filters.value.category)
      }

      return filtered.sort((a, b) => new Date(b.created_at || 0) - new Date(a.created_at || 0))
    })

    // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
    const getTypeIcon = (type) => {
      const icons = {
        image: 'image',
        video: 'play_circle',
        audio: 'music_note',
        pdf: 'picture_as_pdf',
        document: 'description',
        interactive: 'interactive'
      }
      return icons[type] || 'description'
    }

    const getTypeText = (type) => {
      const types = {
        image: 'ØµÙˆØ±Ø©',
        video: 'ÙÙŠØ¯ÙŠÙˆ',
        audio: 'ØµÙˆØª',
        pdf: 'PDF',
        document: 'Ù…Ø³ØªÙ†Ø¯ Ù†ØµÙŠ',
        interactive: 'ØªÙØ§Ø¹Ù„ÙŠ'
      }
      return types[type] || type
    }

    const getStatusText = (status) => {
      const statusMap = {
        published: 'Ù…Ù†Ø´ÙˆØ±',
        pending_review: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
        draft: 'Ù…Ø³ÙˆØ¯Ø©',
        rejected: 'Ù…Ø±ÙÙˆØ¶',
        needs_revision: 'ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„'
      }
      return statusMap[status] || status
    }

    const getStatusIcon = (status) => {
      const icons = {
        published: 'check_circle',
        pending_review: 'pending',
        draft: 'draft',
        rejected: 'cancel',
        needs_revision: 'edit_note'
      }
      return icons[status] || 'draft'
    }

    const getStatusClass = (status) => {
      const classes = {
        published: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300',
        pending_review: 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-300',
        draft: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300',
        rejected: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300',
        needs_revision: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300'
      }
      return classes[status] || classes.draft
    }

    const formatDate = (dateString) => {
      if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
      try {
        return new Date(dateString).toLocaleDateString('ar-EG')
      } catch (error) {
        return 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­'
      }
    }

    // Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
    const previewStory = (story) => {
      console.log('ğŸ‘ï¸ [Ø§Ù„Ù…ÙˆØ¸Ù] Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù‚ØµØ©:', story)
      window.open(`/story/${story.id}`, '_blank')
    }

    const submitForReview = (story) => {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŸ')) {
        try {
          story.status = 'pending_review'
          story.submitted_at = new Date().toISOString()
          
          // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ localStorage
          localStorage.setItem('libraryStories', JSON.stringify(stories.value))
          
          // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«
          window.dispatchEvent(new CustomEvent('storiesUpdated'))
          
          // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¯ÙŠØ±
          sendAdminNotification('content_submitted', story)
          
          console.log('âœ… [Ø§Ù„Ù…ÙˆØ¸Ù] ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:', story)
          alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­')
        } catch (error) {
          console.error('âŒ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰:', error)
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©')
        }
      }
    }

    const copyStoryLink = (story) => {
      const link = `${window.location.origin}/story/${story.id}`
      navigator.clipboard.writeText(link).then(() => {
        alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­ØªÙˆÙ‰')
      }).catch(() => {
        alert('ØªØ¹Ø°Ø± Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·')
      })
    }

    const deleteStory = (story) => {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) {
        try {
          const index = stories.value.findIndex(s => s.id === story.id)
          if (index !== -1) {
            stories.value.splice(index, 1)
            localStorage.setItem('libraryStories', JSON.stringify(stories.value))
            
            // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«
            window.dispatchEvent(new CustomEvent('storiesUpdated'))
            
            console.log('ğŸ—‘ï¸ [Ø§Ù„Ù…ÙˆØ¸Ù] ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰:', story)
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­')
          }
        } catch (error) {
          console.error('âŒ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰:', error)
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰')
        }
      }
    }

    const resetFilters = () => {
      filters.value = {
        search: '',
        type: '',
        status: '',
        category: '',
        myContentOnly: true
      }
    }

    const sendAdminNotification = (type, data) => {
      try {
        const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]')
        notifications.unshift({
          id: Date.now(),
          type,
          data,
          employee_id: user.value?.id,
          employee_name: user.value?.name,
          timestamp: new Date().toISOString(),
          read: false
        })
        localStorage.setItem('adminNotifications', JSON.stringify(notifications))
        console.log('ğŸ“¢ [Ø§Ù„Ù…ÙˆØ¸Ù] ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¯ÙŠØ±')
      } catch (error) {
        console.error('âŒ [Ø§Ù„Ù…ÙˆØ¸Ù] Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', error)
      }
    }

    onMounted(() => {
      console.log('ğŸš€ [Ø§Ù„Ù…ÙˆØ¸Ù] ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙƒÙˆÙ† Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ¸Ù')
      loadData()
      setupRealTimeUpdates()
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
      window.addEventListener('focus', loadData)
    })

    // ØªÙ†Ø¸ÙŠÙ event listener
    onUnmounted(() => {
      console.log('ğŸ§¹ [Ø§Ù„Ù…ÙˆØ¸Ù] ØªÙ†Ø¸ÙŠÙ Ù…ÙƒÙˆÙ† Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ¸Ù')
      window.removeEventListener('focus', loadData)
      window.removeEventListener('storiesUpdated', loadData)
      window.removeEventListener('interactionsUpdated', loadData)
    })

    return {
      stories,
      employeeStats,
      employeeStories,
      filteredStories,
      filters,
      getTypeIcon,
      getTypeText,
      getStatusText,
      getStatusIcon,
      getStatusClass,
      formatDate,
      previewStory,
      submitForReview,
      copyStoryLink,
      deleteStory,
      resetFilters,
      navigateToAddStory
    }
  }
}
</script>

<style scoped>
@import url('https://fonts.googleapis.com/icon?family=Material+Icons');

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± select */
select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23456882' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
  background-position: left 0.75rem center;
  background-repeat: no-repeat;
  background-size: 16px 12px;
  padding-left: 2.5rem;
}

.dark select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 768px) {
  .container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  table {
    font-size: 0.875rem;
  }
  
  .text-3xl {
    font-size: 1.5rem;
  }
}
</style>