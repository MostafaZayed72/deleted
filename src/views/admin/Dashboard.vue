<template>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <AppHeader />
    
    <main class="container mx-auto px-4 py-8">
      
      <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-[#1B3C53] dark:text-white mb-3">
          Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±
        </h1>
        <p class="text-lg text-[#456882] dark:text-gray-300">
          Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ©
        </p>
      </div>

      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ØµØµ</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-blue-400">{{ statistics.totalStories }}</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ statistics.storiesGrowth }}% Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">library_books</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-green-400">{{ statistics.totalUsers }}</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ statistics.usersGrowth }}% Ø¹Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">people</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-purple-400">{{ statistics.todayViews }}</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ statistics.viewsGrowth }}% Ø¹Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">visibility</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-yellow-400">{{ statistics.averageRating }}/5</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ statistics.ratingGrowth }} Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">star</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
        <div class="lg:col-span-2">
          <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>
              <span class="text-sm text-[#456882] dark:text-gray-400">Ø¥Ø¯Ø§Ø±Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù†Ø¸Ø§Ù…</span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <router-link 
                to="/admin/stories/new"
                class="group p-4 border-2 border-dashed border-blue-200 dark:border-blue-800 rounded-xl hover:border-blue-500 dark:hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-300 text-[#1B3C53] dark:text-white block hover:shadow-lg hover:scale-105"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                    <span class="material-icons text-white text-lg">add</span>
                  </div>
                  <div>
                    <p class="font-semibold text-sm">Ø¥Ø¶Ø§ÙØ© Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø©</p>
                    <p class="text-xs text-[#456882] dark:text-gray-400 mt-1">Ø£Ø¶Ù Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ÙƒØªØ¨Ø©</p>
                  </div>
                </div>
              </router-link>

              <router-link 
                to="/admin/users"
                class="group p-4 border-2 border-dashed border-green-200 dark:border-green-800 rounded-xl hover:border-green-500 dark:hover:border-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all duration-300 text-[#1B3C53] dark:text-white block hover:shadow-lg hover:scale-105"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                    <span class="material-icons text-white text-lg">people</span>
                  </div>
                  <div>
                    <p class="font-semibold text-sm">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                    <p class="text-xs text-[#456882] dark:text-gray-400 mt-1">Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                  </div>
                </div>
              </router-link>

              <router-link 
                to="/admin/stories"
                class="group p-4 border-2 border-dashed border-purple-200 dark:border-purple-800 rounded-xl hover:border-purple-500 dark:hover:border-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-300 text-[#1B3C53] dark:text-white block hover:shadow-lg hover:scale-105"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                    <span class="material-icons text-white text-lg">collections_bookmark</span>
                  </div>
                  <div>
                    <p class="font-semibold text-sm">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
                    <p class="text-xs text-[#456882] dark:text-gray-400 mt-1">Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ØµØµ</p>
                  </div>
                </div>
              </router-link>

              <router-link 
                to="/admin/analytics"
                class="group p-4 border-2 border-dashed border-orange-200 dark:border-orange-800 rounded-xl hover:border-orange-500 dark:hover:border-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-all duration-300 text-[#1B3C53] dark:text-white block hover:shadow-lg hover:scale-105"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                    <span class="material-icons text-white text-lg">analytics</span>
                  </div>
                  <div>
                    <p class="font-semibold text-sm">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
                    <p class="text-xs text-[#456882] dark:text-gray-400 mt-1">Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</p>
                  </div>
                </div>
              </router-link>
            </div>
          </div>

          <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©: Ø§Ù„Ù‚ØµØµ + Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Ø£Ø­Ø¯Ø« Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white">Ø£Ø­Ø¯Ø« Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…Ø¶Ø§ÙØ©</h3>
                <router-link 
                  to="/admin/stories" 
                  class="flex items-center gap-1 text-sm text-[#1B3C53] dark:text-blue-400 hover:text-blue-600 dark:hover:text-blue-300 font-medium transition-colors duration-200"
                >
                  Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                  <span class="material-icons text-base">arrow_left</span>
                </router-link>
              </div>
              <div class="space-y-4">
                <div 
                  v-for="story in recentStories" 
                  :key="story.id"
                  class="flex items-center gap-4 p-4 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-blue-300 dark:hover:border-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-300 group"
                >
                  <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                    <span class="material-icons text-white">{{ getTypeIcon(story.story_type) }}</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h4 class="font-semibold text-[#1B3C53] dark:text-white text-sm mb-1 truncate">{{ story.title }}</h4>
                    <div class="flex items-center gap-3 text-xs text-[#456882] dark:text-gray-400">
                      <span class="flex items-center gap-1">
                        <span class="material-icons text-xs">child_care</span>
                        {{ story.age_group }}
                      </span>
                      <span class="flex items-center gap-1">
                        <span class="material-icons text-xs">visibility</span>
                        {{ story.stats?.views || 0 }} Ù…Ø´Ø§Ù‡Ø¯Ø©
                      </span>
                      <span class="flex items-center gap-1">
                        <span class="material-icons text-xs">star</span>
                        {{ story.rating || 0 }}/5
                      </span>
                    </div>
                  </div>
                  <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <router-link 
                      :to="`/admin/stories/edit/${story.id}`"
                      class="p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors duration-200"
                      title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚ØµØ©"
                    >
                      <span class="material-icons text-sm">edit</span>
                    </router-link>
                    <button 
                      @click="deleteStory(story.id)"
                      class="p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200"
                      title="Ø­Ø°Ù Ø§Ù„Ù‚ØµØ©"
                    >
                      <span class="material-icons text-sm">delete</span>
                    </button>
                  </div>
                </div>
                
                <!-- Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‚ØµØµ -->
                <div 
                  v-if="recentStories.length === 0"
                  class="text-center py-8 text-[#456882] dark:text-gray-400"
                >
                  <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="material-icons text-gray-400">library_books</span>
                  </div>
                  <p class="text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ØµØµ Ù…Ø¶Ø§ÙØ© Ø­Ø¯ÙŠØ«Ø§Ù‹</p>
                </div>
              </div>
            </div>

            <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ† -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</h3>
                <router-link 
                  to="/admin/users" 
                  class="flex items-center gap-1 text-sm text-[#1B3C53] dark:text-green-400 hover:text-green-600 dark:hover:text-green-300 font-medium transition-colors duration-200"
                >
                  Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                  <span class="material-icons text-base">arrow_left</span>
                </router-link>
              </div>
              <div class="space-y-4">
                <div 
                  v-for="user in activeUsers" 
                  :key="user.id"
                  class="flex items-center gap-4 p-4 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-300 dark:hover:border-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all duration-300 group"
                >
                  <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-transform duration-300">
                    <span class="text-sm font-bold">{{ user.fullName?.charAt(0) || user.name?.charAt(0) || 'Ù…' }}</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h4 class="font-semibold text-[#1B3C53] dark:text-white text-sm mb-1">{{ user.fullName || user.name || 'Ù…Ø³ØªØ®Ø¯Ù…' }}</h4>
                    <p class="text-xs text-[#456882] dark:text-gray-400 mb-2">{{ user.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯' }}</p>
                    <div class="flex items-center gap-3 text-xs text-[#456882] dark:text-gray-400">
                      <span class="flex items-center gap-1">
                        <span class="material-icons text-xs">category</span>
                        {{ getAccountTypeArabic(user.accountType) }}
                      </span>
                      <span class="flex items-center gap-1">
                        <span class="material-icons text-xs">schedule</span>
                        {{ formatLastActivity(user.lastActivity) }}
                      </span>
                    </div>
                  </div>
                  <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <button 
                      @click="viewUserInteractions(user)"
                      class="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors duration-200"
                      title="Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª"
                    >
                      <span class="material-icons text-sm">insights</span>
                    </button>
                    <button 
                      @click="toggleUserStatus(user)"
                      class="p-2 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-lg transition-colors duration-200"
                      :title="user.status === 'banned' ? 'ÙÙƒ Ø§Ù„Ø­Ø¸Ø±' : 'Ø­Ø¸Ø±'"
                    >
                      <span class="material-icons text-sm">{{ user.status === 'banned' ? 'lock_open' : 'block' }}</span>
                    </button>
                  </div>
                </div>
                
                <!-- Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
                <div 
                  v-if="activeUsers.length === 0"
                  class="text-center py-8 text-[#456882] dark:text-gray-400"
                >
                  <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="material-icons text-gray-400">people</span>
                  </div>
                  <p class="text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <div class="space-y-6">
          
          <!-- Ù†Ø´Ø§Ø· Ø§Ù„Ù†Ø¸Ø§Ù… -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white mb-4">Ù†Ø´Ø§Ø· Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <div class="space-y-4">
              <div 
                v-for="activity in systemActivities" 
                :key="activity.id"
                class="flex items-start gap-3 group"
              >
                <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mt-1 flex-shrink-0 shadow-lg group-hover:scale-110 transition-transform duration-300">
                  <span class="material-icons text-white text-sm">{{ activity.icon }}</span>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm text-[#1B3C53] dark:text-white leading-relaxed">{{ activity.message }}</p>
                  <p class="text-xs text-[#456882] dark:text-gray-400 mt-1">{{ activity.time }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
            <div class="space-y-4">
              <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200">
                <span class="text-sm text-[#1B3C53] dark:text-white flex items-center gap-2">
                  <span class="material-icons text-blue-500 text-sm">add_circle</span>
                  Ø§Ù„Ù‚ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ÙŠÙˆÙ…:
                </span>
                <span class="font-bold text-[#1B3C53] dark:text-blue-400">{{ statistics.newStoriesToday }}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200">
                <span class="text-sm text-[#1B3C53] dark:text-white flex items-center gap-2">
                  <span class="material-icons text-green-500 text-sm">person_add</span>
                  Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯:
                </span>
                <span class="font-bold text-[#1B3C53] dark:text-green-400">{{ statistics.newUsersToday }}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200">
                <span class="text-sm text-[#1B3C53] dark:text-white flex items-center gap-2">
                  <span class="material-icons text-purple-500 text-sm">chat</span>
                  Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
                </span>
                <span class="font-bold text-[#1B3C53] dark:text-purple-400">{{ statistics.newCommentsToday }}</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200">
                <span class="text-sm text-[#1B3C53] dark:text-white flex items-center gap-2">
                  <span class="material-icons text-yellow-500 text-sm">trending_up</span>
                  Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„:
                </span>
                <span class="font-bold text-green-600 dark:text-green-400">{{ statistics.engagementRate }}%</span>
              </div>
            </div>
          </div>

          <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª</h3>
            <div class="grid grid-cols-2 gap-4">
              <div v-for="interaction in interactionStats" :key="interaction.type" 
                   class="text-center p-3 bg-gray-50 dark:bg-gray-700 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200">
                <div class="w-10 h-10 mx-auto mb-2 rounded-xl flex items-center justify-center text-white"
                     :class="getInteractionColor(interaction.type)">
                  <span class="material-icons text-sm">{{ getInteractionIcon(interaction.type) }}</span>
                </div>
                <p class="text-lg font-bold text-[#1B3C53] dark:text-white">{{ interaction.count }}</p>
                <p class="text-xs text-[#456882] dark:text-gray-400">{{ interaction.label }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</template>

<script>
import StatisticsManager from '@/utils/statisticsManager';
import { ref, onMounted, onUnmounted, computed } from 'vue'
import { useRouter } from 'vue-router'

export default {
  name: 'AdminDashboard',
  setup() {
    const router = useRouter()

    const statistics = ref({
      totalStories: 0,
      totalUsers: 0,
      todayViews: 0,
      averageRating: 0,
      newStoriesToday: 0,
      newUsersToday: 0,
      newCommentsToday: 0,
      engagementRate: 0,
      storiesGrowth: 12,
      usersGrowth: 8,
      viewsGrowth: 15,
      ratingGrowth: 0.2
    })

    const recentStories = ref([])
    const activeUsers = ref([])
    const systemActivities = ref([])

    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø­Ø¸ÙŠ
    const setupRealTimeUpdates = () => {
      // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«
      window.addEventListener('interactionsUpdated', loadStatistics);
      window.addEventListener('storiesUpdated', loadStatistics);
      window.addEventListener('usersUpdated', loadStatistics);
      window.addEventListener('statisticsUpdated', loadStatistics);
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù†ÙˆØ¹
    const getTypeIcon = (type) => {
      const icons = {
        image: 'image',
        video: 'play_circle',
        audio: 'music_note',
        pdf: 'picture_as_pdf',
        document: 'description',
        interactive: 'interactive'
      }
      return icons[type] || 'library_books'
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
    const getAccountTypeArabic = (type) => {
      const types = {
        parent: 'ÙˆÙ„ÙŠ Ø£Ù…Ø±',
        teacher: 'Ù…Ø¹Ù„Ù…',
        student: 'Ø·Ø§Ù„Ø¨',
        employee: 'Ù…ÙˆØ¸Ù',
        admin: 'Ø£Ø¯Ù…Ù†'
      }
      return types[type] || type
    }

    

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    const loadStatistics = async () => {
      try {
        console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...');

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… StatisticsManager Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        const generalStats = StatisticsManager.getGeneralStatistics();
        const topStories = StatisticsManager.getTopStories(5);
        const topUsers = StatisticsManager.getTopUsers(5);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        statistics.value.totalStories = generalStats.totalStories;
        statistics.value.totalUsers = generalStats.totalUsers;
        statistics.value.todayViews = generalStats.todayViews;
        statistics.value.averageRating = generalStats.averageRating || 0;
        statistics.value.newStoriesToday = generalStats.newStoriesToday;
        statistics.value.newUsersToday = generalStats.newUsersToday;
        statistics.value.newCommentsToday = generalStats.newCommentsToday;
        statistics.value.engagementRate = generalStats.engagementRate;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ØµØµ Ø§Ù„Ø£Ø®ÙŠØ±Ø©
        recentStories.value = topStories.map(story => ({
          ...story,
          age_group: story.age_group || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
          views: story.stats?.views || 0,
          rating: story.rating || 0
        }));

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
        activeUsers.value = topUsers.map(user => ({
          ...user,
          fullName: user.fullName || user.name || 'Ù…Ø³ØªØ®Ø¯Ù…',
          email: user.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯',
          accountType: user.accountType || 'user',
          lastActivity: user.stats?.lastActivity || user.lastActivity,
          status: user.status || 'active'
        }));

        // ØªØ­Ù…ÙŠÙ„ Ù†Ø´Ø§Ø· Ø§Ù„Ù†Ø¸Ø§Ù…
        loadSystemActivities();

      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
      }
    }

    const loadSystemActivities = () => {
      const generalStats = StatisticsManager.getGeneralStatistics();
      
      systemActivities.value = [
        {
          id: 1,
          icon: 'library_books',
          message: `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${generalStats.newStoriesToday} Ù‚ØµØµ Ø¬Ø¯ÙŠØ¯Ø©`,
          time: 'Ø§Ù„ÙŠÙˆÙ…'
        },
        {
          id: 2,
          icon: 'person_add',
          message: `Ø§Ù†Ø¶Ù… ${generalStats.newUsersToday} Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯`,
          time: 'Ø§Ù„ÙŠÙˆÙ…'
        },
        {
          id: 3,
          icon: 'chat',
          message: `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${generalStats.newCommentsToday} ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯`,
          time: 'Ù…Ù†Ø° Ø³Ø§Ø¹Ø©'
        },
        {
          id: 4,
          icon: 'trending_up',
          message: `${generalStats.todayInteractions} ØªÙØ§Ø¹Ù„ Ø¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…`,
          time: 'Ù…Ù†Ø° Ø³Ø§Ø¹ØªÙŠÙ†'
        }
      ]
    }

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
    const interactionStats = computed(() => {
      const generalStats = StatisticsManager.getGeneralStatistics();
      
      return [
        { type: 'view', count: generalStats.interactionBreakdown?.views || 0, label: 'Ù…Ø´Ø§Ù‡Ø¯Ø§Øª' },
        { type: 'like', count: generalStats.interactionBreakdown?.likes || 0, label: 'Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª' },
        { type: 'download', count: generalStats.interactionBreakdown?.downloads || 0, label: 'ØªØ­Ù…ÙŠÙ„Ø§Øª' },
        { type: 'share', count: generalStats.interactionBreakdown?.shares || 0, label: 'Ù…Ø´Ø§Ø±ÙƒØ§Øª' }
      ]
    })

    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªÙØ§Ø¹Ù„Ø§Øª
    const getInteractionIcon = (type) => {
      const icons = {
        view: 'visibility',
        like: 'favorite',
        download: 'download',
        share: 'share',
        comment: 'comment'
      }
      return icons[type] || 'info'
    }

    const getInteractionColor = (type) => {
      const colors = {
        view: 'bg-blue-500',
        like: 'bg-red-500',
        download: 'bg-green-500',
        share: 'bg-purple-500',
        comment: 'bg-orange-500'
      }
      return colors[type] || 'bg-gray-500'
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø¢Ø®Ø± Ù†Ø´Ø§Ø·
    const formatLastActivity = (dateString) => {
      if (!dateString) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
      const now = new Date()
      const activityDate = new Date(dateString)
      const diffMinutes = Math.floor((now - activityDate) / (1000 * 60))
      
      if (diffMinutes < 60) return `${diffMinutes} Ø¯Ù‚ÙŠÙ‚Ø©`
      if (diffMinutes < 1440) return `${Math.floor(diffMinutes / 60)} Ø³Ø§Ø¹Ø©`
      return `${Math.floor(diffMinutes / 1440)} ÙŠÙˆÙ…`
    }

    // Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
    const deleteStory = async (storyId) => {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù‚ØµØ©ØŸ')) {
        try {
          const stories = JSON.parse(localStorage.getItem('libraryStories') || '[]')
          const updatedStories = stories.filter(story => story.id !== storyId)
          localStorage.setItem('libraryStories', JSON.stringify(updatedStories))
          
          // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«
          window.dispatchEvent(new CustomEvent('storiesUpdated'))
          
          alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­')
          await loadStatistics() // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù‚ØµØ©:', error)
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù‚ØµØ©')
        }
      }
    }

    const toggleUserStatus = async (user) => {
      try {
        const users = JSON.parse(localStorage.getItem('libraryUsers') || '[]')
        const userIndex = users.findIndex(u => u.id === user.id)
        
        if (userIndex !== -1) {
          users[userIndex].status = user.status === 'banned' ? 'active' : 'banned'
          localStorage.setItem('libraryUsers', JSON.stringify(users))
          
          // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«
          window.dispatchEvent(new CustomEvent('usersUpdated'))
          
          await loadStatistics() // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error)
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…')
      }
    }

    const viewUserInteractions = (user) => {
      router.push(`/admin/users?view=interactions&userId=${user.id}`)
    }

    onMounted(() => {
      console.log('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±')
      loadStatistics()
      setupRealTimeUpdates()
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
      const interval = setInterval(loadStatistics, 30000)
      
      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ interval Ø¹Ù†Ø¯ ØªØ¯Ù…ÙŠØ± Ø§Ù„Ù…ÙƒÙˆÙ†
      onUnmounted(() => {
        clearInterval(interval)
        window.removeEventListener('interactionsUpdated', loadStatistics)
        window.removeEventListener('storiesUpdated', loadStatistics)
        window.removeEventListener('usersUpdated', loadStatistics)
        window.removeEventListener('statisticsUpdated', loadStatistics)
      })
    })

    return {
      statistics,
      recentStories,
      activeUsers,
      systemActivities,
      interactionStats,
      getTypeIcon,
      getAccountTypeArabic,
      formatLastActivity,
      getInteractionIcon,
      getInteractionColor,
      deleteStory,
      toggleUserStatus,
      viewUserInteractions
    }
  }
}
</script>

<style scoped>
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
.hover-lift:hover {
  transform: translateY(-2px);
  transition: transform 0.2s ease-in-out;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ± */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: #f1f5f9;
  border-radius: 3px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 3px;
}

.dark .custom-scrollbar::-webkit-scrollbar-track {
  background: #374151;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb {
  background: #4b5563;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 768px) {
  .container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  .text-3xl {
    font-size: 1.5rem;
  }
}
</style>