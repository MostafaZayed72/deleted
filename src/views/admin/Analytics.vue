<template>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <AppHeader />
    
    <main class="container mx-auto px-4 py-8">
      
      <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-[#1B3C53] dark:text-white mb-3">
          Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </h1>
        <p class="text-lg text-[#456882] dark:text-gray-300">
          ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ© ÙˆØ¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
        </p>
      </div>

      <!-- ÙÙ„ØªØ±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <!-- Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
          <div>
            <label class="block text-sm font-medium text-[#1B3C53] dark:text-gray-300 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
            <select 
              v-model="filters.reportType" 
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-[#1B3C53] focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-white appearance-none"
            >
              <option value="overview">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</option>
              <option value="content">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰</option>
              <option value="users">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
              <option value="engagement">Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª</option>
              <option value="performance">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</option>
            </select>
          </div>

          <!-- Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© -->
          <div>
            <label class="block text-sm font-medium text-[#1B3C53] dark:text-gray-300 mb-2">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label>
            <select 
              v-model="filters.timeRange" 
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-[#1B3C53] focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-white appearance-none"
            >
              <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
              <option value="week">Ø£Ø³Ø¨ÙˆØ¹</option>
              <option value="month">Ø´Ù‡Ø±</option>
              <option value="quarter">Ø±Ø¨Ø¹ Ø³Ù†Ø©</option>
              <option value="year">Ø³Ù†Ø©</option>
              <option value="all">ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª</option>
            </select>
          </div>

          <!-- Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
          <div>
            <label class="block text-sm font-medium text-[#1B3C53] dark:text-gray-300 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù…</label>
            <select 
              v-model="filters.chartType" 
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-[#1B3C53] focus:border-transparent bg-white dark:bg-gray-700 text-gray-800 dark:text-white appearance-none"
            >
              <option value="bar">Ø£Ø¹Ù…Ø¯Ø©</option>
              <option value="line">Ø®Ø·ÙŠ</option>
              <option value="pie">Ø¯Ø§Ø¦Ø±ÙŠ</option>
              <option value="doughnut">Ø¯ÙˆÙ†Ø§Øª</option>
              <option value="radar">Ø±Ø§Ø¯Ø§Ø±</option>
            </select>
          </div>

          <!-- Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
          <div class="flex items-end">
            <button 
              @click="generateReport"
              class="w-full bg-gradient-to-r from-[#1B3C53] to-[#234C6A] text-white py-3 px-4 rounded-xl hover:from-[#234C6A] hover:to-[#1B3C53] transition-all duration-200 font-medium shadow-lg flex items-center justify-center gap-2"
            >
              <span class="material-icons text-sm">analytics</span>
              Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ØµØµ</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-blue-400">{{ quickStats.totalStories }}</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ quickStats.storiesGrowth }}% Ø¹Ù† Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">library_books</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-green-400">{{ quickStats.totalUsers }}</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ quickStats.usersGrowth }}% Ø¹Ù† Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">people</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-purple-400">{{ quickStats.totalViews.toLocaleString() }}</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ quickStats.viewsGrowth }}% Ø¹Ù† Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">visibility</span>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-[#456882] dark:text-gray-400 mb-1">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„</p>
              <p class="text-2xl font-bold text-[#1B3C53] dark:text-yellow-400">{{ quickStats.engagementRate }}%</p>
              <p class="text-xs text-green-600 dark:text-green-400 mt-2 flex items-center gap-1">
                <span class="material-icons text-sm">trending_up</span>
                {{ quickStats.engagementGrowth }}% Ø¹Ù† Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©
              </p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="material-icons text-white">thumb_up</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
      <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
        
        <!-- Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
            <h3 class="text-xl font-bold text-[#1B3C53] dark:text-white">{{ getReportTitle() }}</h3>
            <div class="flex items-center gap-2">
              <button 
                @click="exportToPDF"
                class="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-all duration-200 text-sm font-medium"
              >
                <span class="material-icons text-sm">picture_as_pdf</span>
                PDF
              </button>
              <button 
                @click="exportToExcel"
                class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-all duration-200 text-sm font-medium"
              >
                <span class="material-icons text-sm">table_chart</span>
                Excel
              </button>
              <button 
                @click="exportToImage"
                class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-200 text-sm font-medium"
              >
                <span class="material-icons text-sm">image</span>
                ØµÙˆØ±Ø©
              </button>
            </div>
          </div>

          <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
          <div class="h-80">
            <canvas ref="mainChartCanvas"></canvas>
          </div>
        </div>

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-xl font-bold text-[#1B3C53] dark:text-white mb-6">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h3>
          
          <div class="space-y-6">
            <!-- ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
            <div>
              <h4 class="text-lg font-semibold text-[#1B3C53] dark:text-white mb-4 flex items-center gap-2">
                <span class="material-icons text-blue-500">interactions</span>
                ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
              </h4>
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
                  <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ detailedStats.totalLikes }}</div>
                  <div class="text-sm text-blue-600 dark:text-blue-300">Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</div>
                </div>
                <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4">
                  <div class="text-2xl font-bold text-green-600 dark:text-green-400">{{ detailedStats.totalComments }}</div>
                  <div class="text-sm text-green-600 dark:text-green-300">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>
                </div>
                <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-4">
                  <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">{{ detailedStats.totalShares }}</div>
                  <div class="text-sm text-purple-600 dark:text-purple-300">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</div>
                </div>
                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-4">
                  <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">{{ detailedStats.totalDownloads }}</div>
                  <div class="text-sm text-yellow-600 dark:text-yellow-300">Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</div>
                </div>
              </div>
            </div>

            <!-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
            <div>
              <h4 class="text-lg font-semibold text-[#1B3C53] dark:text-white mb-4 flex items-center gap-2">
                <span class="material-icons text-green-500">category</span>
                ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
              </h4>
              <div class="h-48">
                <canvas ref="contentDistributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        
        <!-- Ø§Ù„Ù‚ØµØµ Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ø§Ù‹ -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-purple-500">trending_up</span>
            Ø§Ù„Ù‚ØµØµ Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ø§Ù‹
          </h3>
          <div class="space-y-3">
            <div 
              v-for="(story, index) in topStories" 
              :key="story.id"
              class="flex items-center justify-between p-3 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-purple-300 dark:hover:border-purple-600 transition-all duration-200 group"
            >
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center text-white text-sm font-bold">
                  {{ index + 1 }}
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-[#1B3C53] dark:text-white text-sm truncate">{{ story.title }}</p>
                  <p class="text-xs text-[#456882] dark:text-gray-400">{{ story.author }}</p>
                </div>
              </div>
              <div class="text-left">
                <p class="font-bold text-[#1B3C53] dark:text-white">{{ story.engagement }}</p>
                <p class="text-xs text-[#456882] dark:text-gray-400">ØªÙØ§Ø¹Ù„</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-green-500">star</span>
            Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
          </h3>
          <div class="space-y-3">
            <div 
              v-for="(user, index) in activeUsers" 
              :key="user.id"
              class="flex items-center justify-between p-3 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-300 dark:hover:border-green-600 transition-all duration-200 group"
            >
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                  {{ user.name.charAt(0) }}
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-[#1B3C53] dark:text-white text-sm">{{ user.name }}</p>
                  <p class="text-xs text-[#456882] dark:text-gray-400">{{ user.type }}</p>
                </div>
              </div>
              <div class="text-left">
                <p class="font-bold text-[#1B3C53] dark:text-white">{{ user.activity }}</p>
                <p class="text-xs text-[#456882] dark:text-gray-400">Ù†Ø´Ø§Ø·</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-lg font-bold text-[#1B3C53] dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-blue-500">schedule</span>
            Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ
          </h3>
          <div class="h-48">
            <canvas ref="timeActivityChart"></canvas>
          </div>
        </div>
      </div>

      <!-- ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªÙ‚Ø¯Ù…Ø© -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-xl font-bold text-[#1B3C53] dark:text-white mb-6">ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
          <div class="h-80">
            <canvas ref="performanceChart"></canvas>
          </div>
        </div>

        <!-- Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø¬ÙˆØ¯Ø© -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-xl font-bold text-[#1B3C53] dark:text-white mb-6">Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø¬ÙˆØ¯Ø©</h3>
          <div class="space-y-6">
            <!-- Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ -->
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-[#1B3C53] dark:text-white">Ù…Ø¹Ø¯Ù„ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                <span class="text-sm font-bold text-green-600">{{ qualityMetrics.completionRate }}%</span>
              </div>
              <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div 
                  class="bg-green-500 h-2 rounded-full transition-all duration-1000"
                  :style="{ width: qualityMetrics.completionRate + '%' }"
                ></div>
              </div>
            </div>

            <!-- Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© -->
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-[#1B3C53] dark:text-white">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                <span class="text-sm font-bold text-blue-600">{{ qualityMetrics.avgWatchTime }} Ø¯Ù‚ÙŠÙ‚Ø©</span>
              </div>
              <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div 
                  class="bg-blue-500 h-2 rounded-full transition-all duration-1000"
                  :style="{ width: Math.min(qualityMetrics.avgWatchTime * 10, 100) + '%' }"
                ></div>
              </div>
            </div>

            <!-- Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯ -->
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-[#1B3C53] dark:text-white">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯</span>
                <span class="text-sm font-bold text-red-600">{{ qualityMetrics.bounceRate }}%</span>
              </div>
              <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div 
                  class="bg-red-500 h-2 rounded-full transition-all duration-1000"
                  :style="{ width: qualityMetrics.bounceRate + '%' }"
                ></div>
              </div>
            </div>

            <!-- Ù…Ø¤Ø´Ø± Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
            <div class="text-center p-6 bg-gradient-to-r from-[#1B3C53] to-[#234C6A] rounded-xl text-white">
              <div class="text-3xl font-bold mb-2">{{ qualityMetrics.satisfactionScore }}/10</div>
              <div class="text-sm">Ù…Ø¤Ø´Ø± Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>
</template>

<script>
import { ref, onMounted, watch, nextTick, onUnmounted } from 'vue'
import Chart from 'chart.js/auto'
import StatisticsManager from '@/utils/statisticsManager'

export default {
  name: 'AnalyticsDashboard',
  setup() {
    const filters = ref({
      reportType: 'overview',
      timeRange: 'month',
      chartType: 'bar'
    })

    const quickStats = ref({
      totalStories: 0,
      totalUsers: 0,
      totalViews: 0,
      engagementRate: 0,
      storiesGrowth: 0,
      usersGrowth: 0,
      viewsGrowth: 0,
      engagementGrowth: 0
    })

    const detailedStats = ref({
      totalLikes: 0,
      totalComments: 0,
      totalShares: 0,
      totalDownloads: 0,
      totalRatings: 0
    })

    const qualityMetrics = ref({
      completionRate: 0,
      avgWatchTime: 0,
      bounceRate: 0,
      satisfactionScore: 0
    })

    const topStories = ref([])
    const activeUsers = ref([])

    // Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
    const mainChartCanvas = ref(null)
    const contentDistributionChart = ref(null)
    const timeActivityChart = ref(null)
    const performanceChart = ref(null)

    let mainChart = null
    let contentChart = null
    let timeChart = null
    let performanceChartInstance = null

    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø­Ø¸ÙŠ
    const setupRealTimeUpdates = () => {
      window.addEventListener('storiesUpdated', loadData)
      window.addEventListener('usersUpdated', loadData)
      window.addEventListener('interactionsUpdated', loadData)
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const loadData = async () => {
      await loadStatistics()
      calculateQuickStats()
      calculateDetailedStats()
      calculateQualityMetrics()
      generateSampleData()
      await nextTick()
      initializeCharts()
    }

    const loadStatistics = () => {
      return new Promise((resolve) => {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… StatisticsManager Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        const generalStats = StatisticsManager.getGeneralStatistics()
        const topStoriesData = StatisticsManager.getTopStories(5)
        const topUsersData = StatisticsManager.getTopUsers(5)
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        quickStats.value.totalStories = generalStats.totalStories
        quickStats.value.totalUsers = generalStats.totalUsers
        quickStats.value.totalViews = generalStats.interactionBreakdown?.views || 0
        quickStats.value.engagementRate = generalStats.engagementRate

        detailedStats.value.totalLikes = generalStats.interactionBreakdown?.likes || 0
        detailedStats.value.totalComments = generalStats.interactionBreakdown?.comments || 0
        detailedStats.value.totalShares = generalStats.interactionBreakdown?.shares || 0
        detailedStats.value.totalDownloads = generalStats.interactionBreakdown?.downloads || 0

        topStories.value = topStoriesData.map(story => ({
          id: story.id,
          title: story.title,
          author: story.author,
          engagement: story.stats?.totalInteractions || 0
        }))

        activeUsers.value = topUsersData.map(user => ({
          id: user.id,
          name: user.fullName || user.name,
          type: user.accountType,
          activity: user.stats?.totalInteractions || 0
        }))

        resolve()
      })
    }

    const calculateQuickStats = () => {
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† StatisticsManager
      const generalStats = StatisticsManager.getGeneralStatistics()
      
      quickStats.value = {
        totalStories: generalStats.totalStories,
        totalUsers: generalStats.totalUsers,
        totalViews: generalStats.interactionBreakdown?.views || 0,
        engagementRate: generalStats.engagementRate,
        storiesGrowth: 12,
        usersGrowth: 8,
        viewsGrowth: 25,
        engagementGrowth: 15
      }
    }

    const calculateDetailedStats = () => {
      const generalStats = StatisticsManager.getGeneralStatistics()
      
      detailedStats.value = {
        totalLikes: generalStats.interactionBreakdown?.likes || 0,
        totalComments: generalStats.interactionBreakdown?.comments || 0,
        totalShares: generalStats.interactionBreakdown?.shares || 0,
        totalDownloads: generalStats.interactionBreakdown?.downloads || 0,
        totalRatings: 0 // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹
      }
    }

    const calculateQualityMetrics = () => {
      qualityMetrics.value = {
        completionRate: 78,
        avgWatchTime: 8.5,
        bounceRate: 22,
        satisfactionScore: 8.7
      }
    }

    const generateSampleData = () => {
      // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ù…Ù† StatisticsManager
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
    const initializeCharts = () => {
      destroyCharts()
      createMainChart()
      createContentDistributionChart()
      createTimeActivityChart()
      createPerformanceChart()
    }

    const createMainChart = () => {
      if (!mainChartCanvas.value) return
      
      const ctx = mainChartCanvas.value.getContext('2d')
      
      const timeStats = StatisticsManager.getTimeBasedStatistics(30)
      const labels = timeStats.dailyStats.map(stat => 
        new Date(stat.date).toLocaleDateString('ar-EG', { day: 'numeric', month: 'short' })
      )
      const viewsData = timeStats.dailyStats.map(stat => stat.views)
      const interactionsData = timeStats.dailyStats.map(stat => stat.total)

      const data = {
        labels: labels,
        datasets: [
          {
            label: 'Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª',
            data: viewsData,
            backgroundColor: '#1B3C53',
            borderColor: '#1B3C53',
            borderWidth: 2
          },
          {
            label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª',
            data: interactionsData,
            backgroundColor: '#456882',
            borderColor: '#456882',
            borderWidth: 2
          }
        ]
      }

      const config = {
        type: filters.value.chartType,
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              rtl: true
            },
            title: {
              display: true,
              text: getReportTitle()
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      }

      mainChart = new Chart(ctx, config)
    }

    const createContentDistributionChart = () => {
      if (!contentDistributionChart.value) return
      
      const ctx = contentDistributionChart.value.getContext('2d')
      
      const stories = JSON.parse(localStorage.getItem('libraryStories') || '[]')
      const typeCounts = {
        pdf: 0,
        video: 0,
        audio: 0,
        image: 0,
        text: 0
      }

      stories.forEach(story => {
        if (typeCounts.hasOwnProperty(story.story_type)) {
          typeCounts[story.story_type]++
        }
      })

      const data = {
        labels: ['PDF', 'ÙÙŠØ¯ÙŠÙˆ', 'ØµÙˆØª', 'ØµÙˆØ±Ø©', 'Ù†Øµ'],
        datasets: [{
          data: [
            typeCounts.pdf,
            typeCounts.video,
            typeCounts.audio,
            typeCounts.image,
            typeCounts.text
          ],
          backgroundColor: [
            '#1B3C53',
            '#456882',
            '#6D8BA0',
            '#94A9B9',
            '#B8C7D2'
          ],
          borderWidth: 2,
          borderColor: '#fff'
        }]
      }

      contentChart = new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              rtl: true
            }
          }
        }
      })
    }

    const createTimeActivityChart = () => {
      if (!timeActivityChart.value) return
      
      const ctx = timeActivityChart.value.getContext('2d')
      
      const data = {
        labels: ['8-10', '10-12', '12-2', '2-4', '4-6', '6-8', '8-10'],
        datasets: [{
          label: 'Ø§Ù„Ù†Ø´Ø§Ø·',
          data: [120, 190, 300, 250, 180, 220, 150],
          backgroundColor: 'rgba(59, 130, 246, 0.5)',
          borderColor: 'rgb(59, 130, 246)',
          borderWidth: 2,
          fill: true
        }]
      }

      timeChart = new Chart(ctx, {
        type: 'line',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      })
    }

    const createPerformanceChart = () => {
      if (!performanceChart.value) return
      
      const ctx = performanceChart.value.getContext('2d')
      
      const topStoriesData = StatisticsManager.getTopStories(5)
      
      const data = {
        labels: topStoriesData.map(story => story.title),
        datasets: [
          {
            label: 'Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª',
            data: topStoriesData.map(story => story.stats?.views || 0),
            backgroundColor: 'rgba(79, 70, 229, 0.5)'
          },
          {
            label: 'Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª',
            data: topStoriesData.map(story => story.stats?.totalInteractions || 0),
            backgroundColor: 'rgba(16, 185, 129, 0.5)'
          }
        ]
      }

      performanceChartInstance = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              rtl: true
            }
          },
          scales: {
            x: {
              stacked: false
            },
            y: {
              stacked: false
            }
          }
        }
      })
    }

    const destroyCharts = () => {
      if (mainChart) mainChart.destroy()
      if (contentChart) contentChart.destroy()
      if (timeChart) timeChart.destroy()
      if (performanceChartInstance) performanceChartInstance.destroy()
    }

    const generateReport = () => {
      loadData()
    }

    const getReportTitle = () => {
      const titles = {
        overview: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©',
        content: 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰',
        users: 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
        engagement: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª',
        performance: 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰'
      }
      return titles[filters.value.reportType] || 'ØªÙ‚Ø±ÙŠØ± ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
    }

    const exportToPDF = () => {
      alert('âœ… ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù PDF')
      // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ jsPDF
    }

    const exportToExcel = () => {
      const data = StatisticsManager.exportData('json')
      const blob = new Blob([data], { type: 'application/json' })
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = `library-report-${new Date().toISOString().split('T')[0]}.json`
      document.body.appendChild(a)
      a.click()
      document.body.removeChild(a)
      URL.revokeObjectURL(url)
      
      alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­')
    }

    const exportToImage = () => {
      alert('âœ… ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„ØªØ­Ù…ÙŠÙ„ ÙƒØµÙˆØ±Ø©')
      // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: ØªØ­ÙˆÙŠÙ„ Canvas Ø¥Ù„Ù‰ ØµÙˆØ±Ø©
    }

    onMounted(() => {
      console.log('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª')
      loadData()
      setupRealTimeUpdates()
      
      // ØªÙ†Ø¸ÙŠÙ event listeners Ø¹Ù†Ø¯ ØªØ¯Ù…ÙŠØ± Ø§Ù„Ù…ÙƒÙˆÙ†
      onUnmounted(() => {
        destroyCharts()
        window.removeEventListener('storiesUpdated', loadData)
        window.removeEventListener('usersUpdated', loadData)
        window.removeEventListener('interactionsUpdated', loadData)
      })
    })

    watch(() => filters.value, () => {
      loadData()
    }, { deep: true })

    return {
      filters,
      quickStats,
      detailedStats,
      qualityMetrics,
      topStories,
      activeUsers,
      mainChartCanvas,
      contentDistributionChart,
      timeActivityChart,
      performanceChart,
      generateReport,
      exportToPDF,
      exportToExcel,
      exportToImage,
      getReportTitle
    }
  }
}
</script>

<style scoped>
@import url('https://fonts.googleapis.com/icon?family=Material+Icons');

/* ØªØ­Ø³ÙŠÙ†Ø§Øª select */
select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23456882' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
  background-position: left 0.75rem center;
  background-repeat: no-repeat;
  background-size: 16px 12px;
  padding-left: 2.5rem;
}

.dark select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 768px) {
  .container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  .text-3xl {
    font-size: 1.5rem;
  }
}
</style>